<!DOCTYPE module SYSTEM "module.dtd">

<module name="visual_servoing" dir="visual_servoing">
  <doc>
    <description>
    Exercise module for Autonomous Flight of MAV Course
    </description>
    <section name="VS" prefix="VS_">
      <define name="NOM_THROTTLE" value="0.68" description="nominal throttle"/>
      <define name="DIVERGENCE_SP" value="1" description="divergence set-point"/>
      <define name="DIV_FACTOR" value="40000" description="scaling factor for divergence estimate"/>
      <define name="ACC_Y_SP" value="0" description="x acceleration set-point"/>
      <define name="ACC_Z_SP" value="0" description="y acceleration set-point"/>
      <define name="OL_X_PGAIN" value="0.1" description="outer loop x proportional gain"/>
      <define name="OL_Y_PGAIN" value="0.1" description="outer loop y proportional gain"/>
      <define name="OL_Z_PGAIN" value="1" description="0 = fake vision, 1 = real vision"/>
      <define name="OL_X_DGAIN" value="0" description="0 = fixed gain control, 1 = adaptive gain control, 2 = exponential control"/>
      <define name="OL_Y_DGAIN" value="0" description="0 = cov(uz, div), 1 = cov(div_past, div)"/>
      <define name="OL_Z_DGAIN" value="0" description="Number of time steps for window size for getting the covariance over time."/>
      <define name="IL_H_PGAIN" value="0.10" description="I gain on summed height error"/>
      <define name="IL_H_IGAIN" value="0.001" description="0 = fake vision, 1 = real vision"/>
      <define name="IL_H_DGAIN" value="0.1" description="D gain on summed height error"/>
      <define name="LP_CONST" value="0.2" description="Low pass filter constant"/>
    </section>
  </doc>
  <settings>
    <dl_settings>
      <dl_settings NAME="VisualServoing">
        <dl_setting var="visual_servoing.nominal_throttle" min="0" step="0.01" max="0.7" module="visual_servoing/visual_servoing" shortname="nominal_throttle" param="VS_NOM_THROTTLE"/>
        <dl_setting var="visual_servoing.divergence_sp" min="0" step="0.001" max="1" module="visual_servoing/visual_servoing" shortname="divergence_sp" param="VS_DIVERGENCE_SP"/>
        <dl_setting var="visual_servoing.div_factor" min="0" step="100" max="5000" module="visual_servoing/visual_servoing" shortname="div_factor" param="VS_DIV_FACTOR"/>
        <dl_setting var="visual_servoing.acc_y_sp" min="-10" step="0.1" max="10" module="visual_servoing/visual_servoing" shortname="acc_y_sp" param="VS_ACC_Y_SP"/>
        <dl_setting var="visual_servoing.acc_z_sp" min="0" step="1000" max="1000000" module="visual_servoing/visual_servoing" shortname="acc_z_sp" param="VS_ACC_Z_SP"/>
        <dl_setting var="visual_servoing.ol_x_pgain" min="0" step="0.1" max="15" module="visual_servoing/visual_servoing" shortname="ol_x_pgain" param="VS_OL_X_PGAIN"/>
        <dl_setting var="visual_servoing.ol_y_pgain" min="0" step="0.001" max="1" module="visual_servoing/visual_servoing" shortname="ol_y_pgain" param="VS_OL_Y_PGAIN"/>
        <dl_setting var="visual_servoing.ol_z_pgain" min="0" step="0.001" max="6" module="visual_servoing/visual_servoing" shortname="ol_z_pgain" param="VS_OL_z_PGAIN"/>
        <dl_setting var="visual_servoing.ol_x_dgain" min="0" step="0.001" max="6" module="visual_servoing/visual_servoing" shortname="ol_x_dgain" param="VS_OL_X_DGAIN"/>
        <dl_setting var="visual_servoing.ol_y_dgain" min="0" step="0.001" max="0.1" module="visual_servoing/visual_servoing" shortname="ol_y_dgain" param="VS_OL_Y_DGAIN"/>
        <dl_setting var="visual_servoing.ol_z_dgain" min="0" step="0.001" max="6" module="visual_servoing/visual_servoing" shortname="ol_z_dgain" param="VS_OL_z_DGAIN"/>
        <dl_setting var="visual_servoing.il_h_pgain" min="0" step="0.001" max="6" module="visual_servoing/visual_servoing" shortname="il_h_pgain" param="VS_IL_H_PGAIN"/>
        <dl_setting var="visual_servoing.il_h_igain" min="0" step="0.001" max="0.1" module="visual_servoing/visual_servoing" shortname="il_h_igain" param="VS_IL_H_IGAIN"/>
        <dl_setting var="visual_servoing.il_h_dgain" min="0" step="0.001" max="6" module="visual_servoing/visual_servoing" shortname="il_h_dgain" param="VS_IL_H_DGAIN"/>
        <dl_setting var="visual_servoing.lp_const" min="0" step="0.001" max="0.1" module="visual_servoing/visual_servoing" shortname="lp_const" param="VS_LP_CONST"/>
      </dl_settings>
    </dl_settings>
  </settings>

  <dep>
    <depends>cv_detect_color_object</depends>
  </dep>

  <header>
    <file name="visual_servoing.h"/>
  </header>
  
  <makefile target="ap|nps">
    <file name="visual_servoing.c"/>
    <define name="VISUAL_SERVOING_CAMERA" value="front_camera"/>
  </makefile>
</module>